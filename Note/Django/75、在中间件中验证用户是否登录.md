在中间件中验证用户是否登录

**首先**在`settings.py`中设置白名单

`WHITE_LIST=['/login/','/register/','/logout/']`



**再**编写中间件类，去验证：

```python
class AuthMiddleWare(MiddlewareMixin):

    def process_request(self,request):
        white_list=settings.WHITE_LIST

        if request.path in white_list:
            # 如果在中间件中返回None，那么将结束中间件的执行过程
            return None

        # 只有在用户登录后，并且执行了auth.authenticate(username=xx,password=xx)后，request.user才是当前登录用户，否则为匿名用户。如果当前登录用户的not is_authenticated为True的话，那么就表示用户没有登录，那么将重定向到登录页面
        if not request.user.is_authenticated:
            return redirect('/login/')
```



最后再`settings.py`中添加引入中间件

```python
MIDDLEWARE = [
    'setCookie.my_middleware.AuthMiddleWare',
]
```



此时，如果直接访问index页面，该路径不在白名单中，将执行`if not request.user.is_authenticated`判断，跳转到`login`路径，如果用户通过`login`视图函数执行通过了`auth.authenticate`方法后，那么`request.user`将变为当前登录用户对象，如果没有验证登录成功，那么就会被重定向到`login`路径



如果只有部分视图函数需要，那么就为视图函数添加装饰器即可，如果有很多视图函数都要验证是否登录，就在中间件中去验证是否登录

阅读session和auth中间件，查看实现逻辑