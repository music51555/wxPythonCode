访问个人站点，路由分发

在路由分发时，如果访问`login、index、alex`等路径，浏览器会自动加上`“/”`结尾

```python
urlpatterns = [
    # 以^开头，就表示以根路径开头，分组后，就会得到用户输入的内容，存储到别名username上
    re_path(r'^(?P<username>\w+)$', views.home_site),
]
```



**按对象跨表查询是基于子查询，对象就表示当前这张表，可以读取表中的字段值**，如

**正向查询：**`user.username`表示查询出`user`对象的`username`字段值，

**反向查询：**`user.article_set.all()`表示,利用对象，反向查询出文章表中该用户的所有文章



**基于双下划线跨表查询是join查询，同样是正向查询按字段，反向查询按表名。一般在`filter`和`values`中使用，基于`modles`中的表名接口使用，如`Article`**

**正向查询：**`Article.object.filter(user=user)`

**反向查询：**`article_list=UserInfo.objects.filter(username=user).values('article__title')`

在`filter`中利用到了双下划线的跨表查询

```python
def home_site(request, username):

    # 首先判断是否有当前在URL中访问的用户
    user = UserInfo.objects.filter(username=username).first()

    if not user:
        # 如果用户不存在，那么返回not_found.html页面
        return render(request, 'not_found.html')
    else:
        article_list = user.article_set.all()

        article_list = Article.objects.filter(user=user)

        # 查询当前站点每一个分类下的文章数，Category分类表中有blog字段，是外键列一对多关系，利用当前user按对象跨表查询出站点对象，并给予主键分组，通过聚合函数跨表统计查询文章总数，展示出分类名和对应的文章总数
            cate_list=Category.objects.filter(blog=user.blog).values('pk').annotate(article_count=Count('article__nid')).values('title','article_count')

        # 查询当前站点每一个标签下的文章数，Article文章表中有tags字段，是多对多关系，反向查询按表名，写为article__nid
        tag_list=Tag.objects.filter(blog=user.blog).values('nid').annotate(c=Count('article__nid')).values('title', 'c')

        return HttpResponse('OK')
```



数据库中时间有三种类型：

`date time datetime`，三种数据类型插入数据后，展示不同样式的数据

```mysql
insert into time_table values(1,now(),now(),now());

mysql> select * from time_table;
+-----+------------+----------+---------------------+
| nid | d          | t        | dt                  |
+-----+------------+----------+---------------------+
|   1 | 2018-12-13 | 16:48:25 | 2018-12-13 16:48:25 |
+-----+------------+----------+---------------------+
```



如果在`dt`字段中按格式只取出年、月，就要利用`date_format（目标字段，时间格式）`方法

```mysql
mysql> select date_format(dt,'%Y-%m-%d') from time_table;
+----------------------------+
| date_format(dt,'%Y-%m-%d') |
+----------------------------+
| 2018-12-13                 |
+----------------------------+
```



