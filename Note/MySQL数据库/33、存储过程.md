存储过程

**无参数存储过程**

存储过程包含了一系列可执行的sql语句，通过调用它的名字可以执行其内部的一堆sql 

操作哪个数据库就应该将存储过程储存到对应的数据库下

**创建存储过程  **

procedure  /prə'sidʒɚ/ 程序，手续；步骤 

```mysql
mysql> delimiter //
mysql> create procedure p1()
    -> begin
    -> select * from db1.userinfo;
    -> end//
mysql> delimiter ;
```



**查看存储过程**

```mysql
show create procedure p1\G;
```



**在mysql调用存储过程**

```mysql
mysql> call p1();
+----+-----------+----------+
| id | username  | password |
+----+-----------+----------+
|  1 | wangxin   | 123456   |
|  2 | peiqi     | 123      |
|  9 | alex      | 123456   |
| 10 | wangji    | 123456   |
| 11 | wangcong  | 123456   |
| 12 | wanghsuai | 123456   |
+----+-----------+----------+
```



**在代码中调用存储过程**

```python
cursor=conn.cursor(pymysql.cursors.DictCursor)
#调用光标下的callproc()方法
cursor.callproc('p1')
res=cursor.fetchall()
print(res)

'''
[{'id': 1, 'username': 'wangxin', 'password': '123456'}, {'id': 2, 'username': 'peiqi', 'password': '123'}, {'id': 9, 'username': 'alex', 'password': '123456'}, {'id': 10, 'username': 'wangji', 'password': '123456'}, {'id': 11, 'username': 'wangcong', 'password': '123456'}, {'id': 12, 'username': 'wanghsuai', 'password': '123456'}]
'''
```



**有参数存储过程**

1、参数必须数据类型

```mysql
delimiter //
#in表示传入的参数，out表示返回的结果，如果执行成功，设置res=1
create procedure p2(in n1 int,in n2 int,out res int)
begin
select * from userinfo where id > n1 and id < n2;
set res=1;
end//
delimiter ;
```



**在mysql调用存储过程**

```mysql
#设置初始值x为0，用于存储过程返回的res赋值
set @x=0
mysql> call p2(1,3,@x);
+----+----------+----------+
| id | username | password |
+----+----------+----------+
|  2 | peiqi    | 123      |
+----+----------+----------+

#查看返回的res值
mysql> select @x;
+------+
| @x   |
+------+
|    1 |
+------+
```

