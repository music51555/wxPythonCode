group by

分组进行管理，优先级在where之后

1、先确定使用哪个表

2、确定有没有where查询条件

3、有没有group by分组的概念

4、查看有没有having过滤，在having过滤中，不能使用别名进行比较，因为还没有运行到select ...

5、去重，select distinct *.......

6、再进行order by排序，在order排序中也可以使用聚合函数，是因为已经进行过分组了，但是在order by中可以使用别名进行排序，**是因为order by是运行在distinct之后，所以加上步骤5**

当要求以每个xxx时，就以xxx为分组依据，group by xxx

```mysql
分组：
set global sql_mode="ONLY_FULL_GROUP_BY"

#未修改数据库模式时，分组的显示结果，是按照所有查询结果中，每一个组别下的第一条数据
mysql> select * from employee group by post;
+----+--------+--------+-----+------------+-----------------------------------------
| id | name   | sex    | age | hire_date  | post                                    
+----+--------+--------+-----+------------+-----------------------------------------
| 14 | 张野   | male   |  28 | 2016-03-11 | operation                               
|  9 | 歪歪   | female |  48 | 2015-03-11 | sale                                    
|  2 | alex   | male   |  78 | 2015-03-02 | teacher                                
|  1 | egon   | male   |  18 | 2017-03-01 | 老男孩驻沙河办事处外交大使                  
+----+--------+--------+-----+------------+-----------------------------------------


#修改分组模式后，只能查看分组的字段值，不能再以*查看
mysql> select post from employee group by post;
+-----------------------------------------+
| post                                    |
+-----------------------------------------+
| operation                               |
| sale                                    |
| teacher                                 |
| 老男孩驻沙河办事处外交大使                  |
+-----------------------------------------+


#列举每个职位下的员工姓名,使用group_concat可以列举每个分组下的其他字段值
mysql> select post,group_concat(name) from employee group by post;
+------------------------------+---------------------------------------------------------+
| post                         | group_concat(name)                                      |
+------------------------------+---------------------------------------------------------+
| operation                    | 程咬铁,程咬铜,程咬银,程咬金,张野                            |
| sale                         | 格格,星星,丁丁,丫丫,歪歪                                   |
| teacher                      | 成龙,jinxin,jingliyang,liwenzhou,yuanhao,wupeiqi,alex   |
| 老男孩驻沙河办事处外交大使       | egon                                                    |
+------------------------------+---------------------------------------------------------+
```



**结合聚合函数**

只能在分组后使用，如果没有分组，在默认查询后就是默认一组

在where后不能使用聚合函数，在执行角度来讲，先找到查询的表，再运行where条件，此时没有分组，如果就不能使用聚合函数，但是如果将聚合函数放在查询的列中，如select count(*) from employee中是可以使用的，是因为先找到查询的表，再运行where条件，再执行了select，默认的查询结果就是默认分组，所以就是在默认分组的情况下使用了聚合函数

**max**

```mysql
mysql> select max(salary) from employee;
+-------------+
| max(salary) |
+-------------+
|  1000000.31 |
+-------------+
```



**min**

```mysql
mysql> select min(salary) from employee;
+-------------+
| min(salary) |
+-------------+
|     1000.37 |
+-------------+
```



**avg**

```mysql
mysql> select avg(salary) from employee;
+--------------+
| avg(salary)  |
+--------------+
| 64844.568889 |
+--------------+
```



**sum**

```mysql
mysql> select sum(salary) from employee;
+-------------+
| sum(salary) |
+-------------+
|  1167202.24 |
+-------------+
```



**count**

```mysql
#统计每个职位有多少员工，一提到每个职位，就是按职位去分组，通过count计算每个分组的有个多少个id
mysql> select post,count(id) from employee group by post;
+-----------------------------------------+-----------+
| post                                    | count(id) |
+-----------------------------------------+-----------+
| operation                               |         5 |
| sale                                    |         5 |
| teacher                                 |         7 |
| 老男孩驻沙河办事处外交大使                  |         1 |
+-----------------------------------------+-----------+

#统计表中有多少条数据
mysql> select count(*) from employee;
+----------+
| count(*) |
+----------+
|       18 |
+----------+
```



**注意：**

1、不要使用有unique约束的列作为分组依据，因为每一条记录都是独立的，那么就会有多少记录，就会分为多少组，没有任何意义

2、没有group by则默认就是一组



**练习题：**

```mysql
#查询岗位名以及岗位包含的所有员工名字
mysql> select post,group_concat(name) from employee group by post;
+----------------------------+---------------------------------------------------------+
| post                       | group_concat(name)                                      |
+----------------------------+---------------------------------------------------------+
| operation                  | 程咬铁,程咬铜,程咬银,程咬金,张野                             |
| sale                       | 格格,星星,丁丁,丫丫,歪歪                                   |
| teacher                    | 成龙,jinxin,jingliyang,liwenzhou,yuanhao,wupeiqi,alex   |
| 老男孩驻沙河办事处外交大使     | egon                                                    |
+-----------------------------------------+----------------------------------------------


#查询岗位名以及各岗位内包含的员工个数
mysql> select post,count(id) from employee group by post;
+-----------------------------------------+-----------+
| post                                    | count(id) |
+-----------------------------------------+-----------+
| operation                               |         5 |
| sale                                    |         5 |
| teacher                                 |         7 |
| 老男孩驻沙河办事处外交大使                  |         1 |
+-----------------------------------------+-----------+

#查询公司内男员工和女员工的个数
mysql> select sex,count(id) from employee group by sex;
+--------+-----------+
| sex    | count(id) |
+--------+-----------+
| male   |        10 |
| female |         8 |
+--------+-----------+

#查询岗位名以及各岗位的平均薪资
mysql> select post,avg(salary) from employee group by post;
+-----------------------------------------+---------------+
| post                                    | avg(salary)   |
+-----------------------------------------+---------------+
| operation                               |  16800.026000 |
| sale                                    |   2600.294000 |
| teacher                                 | 151842.901429 |
| 老男孩驻沙河办事处外交大使                  |   7300.330000 |
+-----------------------------------------+---------------+

#查询岗位名以及各岗位的最高薪资
mysql> select post,max(salary) from employee group by post;
+-----------------------------------------+-------------+
| post                                    | max(salary) |
+-----------------------------------------+-------------+
| operation                               |    20000.00 |
| sale                                    |     4000.33 |
| teacher                                 |  1000000.31 |
| 老男孩驻沙河办事处外交大使                  |     7300.33 |
+-----------------------------------------+-------------+

#查询岗位名以及各岗位的最低薪资
mysql> select post,min(salary) from employee group by post;
+-----------------------------------------+-------------+
| post                                    | min(salary) |
+-----------------------------------------+-------------+
| operation                               |    10000.13 |
| sale                                    |     1000.37 |
| teacher                                 |     2100.00 |
| 老男孩驻沙河办事处外交大使                  |     7300.33 |
+-----------------------------------------+-------------+

#查询男员工与男员工的平均薪资，女员工与女员工的平均薪资
mysql> select sex,avg(salary) from employee group by sex;
+--------+---------------+
| sex    | avg(salary)   |
+--------+---------------+
| male   | 110920.077000 |
| female |   7250.183750 |
+--------+---------------+
```

